import pickle

with open('ml_model/vuln_predictor.pkl', 'rb') as f:
    model = pickle.load(f)

def predict_vulnerability(features):
    os_type_map = {
        'Linux': 0,
        'Windows': 1,
        'Unknown': 2,
        'FreeBSD': 3,
        'Mac OS X': 4
    }
    
    os_code = os_type_map.get(features['os_type'], 2)

    input_data = [[
        features['open_ports_count'],
        features['common_ports_open'],
        os_code
    ]]
    prediction = model.predict(input_data)
    return prediction[0]